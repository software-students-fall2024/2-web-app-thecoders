{% extends "base.html" %}

{% block title %}Add Page{% endblock %}

{% block header %}
    <h1>Add a Job Application</h1>
    {% include "components/back-link.html" %}
{% endblock %}
{% block styles %}
    <style>
        .select-box{
            margin-top: 10px;
            width: 380px;
            position: relative;
        }
        .select-option{
            position: relative;
            border: 1px solid black;
        }
        .select-option input{
            width: 100%;
            background-color: #fff;
            color: #000;
            border-radius: 7px;
            cursor: pointer;
            font-size: 18px;
            padding: 15px 20px;
            border: 0 !important;
            outline: 0 !important;
        }
        .select-option:after{
            content: "";
            border-top: 12px solid #000;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            position: absolute;
            right: 15px;
            top: 50%;
            margin-top: -8px;
        }
        .content{
            background-color: #fff;
            position: absolute;
            color: #000;
            border-radius: 7px;
            margin-top: 15px;
            width: 100%;
            z-index: 999;
            padding: 20px;
            display: none;
        }
        .search input{
            width: 100%;
            font-size: 17px;
            padding: 15px;
            outline: 0;
            border: 1px solid #b3b3b3;
            border-radius: 5px;
        }
        .options{
            margin-top: 10px;
            max-height: 250px;
            overflow-y: auto;
            padding: 0;
        }
        .options li{
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            border-bottom: 1px solid gray;
        }
        .options li:hover{
            background-color: #f2f2f2;
        }
        .select-box.active .content{
            display: block;
        }
        .select-box.active .select-option:after{
            transform: rotate(-180deg);
        }
    </style>
{% endblock %}
{% block content %}
    <article>
        <!-- Information about required fields-->
        <p><span class="required">*</span> indicates required fields</p>

        <form method="POST" action="{{url_for('add_post')}}">
            {% if count==0 %}
                <label for="titleInput">Job Title: <span class="required">*</span></label>
                <input type="text" id="titleInput" name="job_title" placeholder="job title" required/>
                <br/>
                <label for="companyInput">Company: <span class="required">*</span></label>
                <input type="text" id="companyInput" name="company" placeholder="company" required/>
                <br/>
                <label for="locationInput">Location: <span class="required">*</span></label>
                <div class="select-box">
                    <div class="select-option">
                        <input type="text" id="locationInput" name="location" placeholder="Select" readonly>
                    </div>
                    <div class="content">
                        <div class="search">
                            <input type="text" id="optionSearch" placeholder="Search" name="">
                        </div>
                        <ul class="options">
                            {% for location in locations %}
                                <li>{{location}}</li>
                            {% endfor %}
                        </ul>
                    </div>        
                </div>
                <br/>
                <label for="linkInput">Link (to the job description):</label>
                <input type="text" id="linkInput" name="link" placeholder="link to the job description"/>
                <br/>
                <label for="stageInput">Stage: <span class="required">*</span></label>
                <input type="text" id="stageInput" name="stage" placeholder="stage" required/>
                <br/>
                <label for="timeInput">Time/DDL:</label>
                <input type="text" id="timeInput" name="time" placeholder="YYYY/MM/DD"/>
                <br/>
                <input type="submit" value="Save"/>
            {% else %}
                <label for="titleInput">Job Title: <span class="required">*</span></label>
                <input type="text" id="titleInput" name="job_title" value="{{doc.job_title}}" required/>
                <br/>
                <label for="companyInput">Company: <span class="required">*</span></label>
                <input type="text" id="companyInput" name="company" value="{{doc.company}}" required/>
                <br/>
                <label for="locationInput">Location: <span class="required">*</span></label>
                <div class="select-box">
                    <div class="select-option">
                        <input type="text" id="locationInput" name="location" placeholder="Select" readonly>
                    </div>
                    <div class="content">
                        <div class="search">
                            <input type="text" id="optionSearch" placeholder="Search" name="">
                        </div>
                        <ul class="options">
                            {% for location in locations %}
                                <li>{{location}}</li>
                            {% endfor %}
                        </ul>
                    </div>        
                </div>
                <br/>
                <label for="linkInput">Link (to the job description):</label>
                <input type="text" id="linkInput" name="link" value="{{doc.link}}"/>
                <br/>
                <label for="stageInput">Stage: <span class="required">*</span></label>
                <input type="text" id="stageInput" name="stage" value="{{doc.stage}}" required/>
                <br/>
                <label for="timeInput">Time/DDL:</label>
                <input type="text" id="timeInput" name="time" placeholder="YYYY/MM/DD"/>
                <br/>
                <input type="submit" value="Save"/>
            {% endif %}
        </form>
    </article>
    <script>
        const selectBox = document.querySelector('.select-box');
        const selectOption = document.querySelector('.select-option');
        const locationInput = document.querySelector('#locationInput');
        const optionSearch = document.querySelector('#optionSearch');
        const options = document.querySelector('.options');
        const optionsList = document.querySelectorAll('.options li');

        selectOption.addEventListener('click',function(){
            selectBox.classList.toggle('active');
        });

        optionsList.forEach(function(optionsListSingle){
            optionsListSingle.addEventListener('click',function(){
                text = this.textContent;
                locationInput.value = text;
                selectBox.classList.remove('active');
            })
        });

        optionSearch.addEventListener('keyup',function(){
            var filter, li, i, textValue;
            filter = optionSearch.value.toLowerCase();
            //li = options.getElementByTagName('li');
            li = document.querySelectorAll('.options li');
            for(i=0;i<li.length;i++){
                liCount = li[i];
                textValue = liCount.textContent || liCount.innerText;
                if (textValue.toLowerCase().indexOf(filter) > -1){
                    li[i].style.display = '';
                }else{
                    li[i].style.display = 'none';
                }
            }
        })
    </script>
{% endblock %}